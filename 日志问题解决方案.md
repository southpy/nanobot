# nanobot Gateway æ—¥å¿—é—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜åˆ†æ

### åŸå› 
1. **Loguru é»˜è®¤çº§åˆ«**ï¼šnanobot ä½¿ç”¨ `loguru` ä½œä¸ºæ—¥å¿—åº“ï¼Œé»˜è®¤æ—¥å¿—çº§åˆ«ä¸º WARNING
2. **é…ç½®ä¸å®Œæ•´**ï¼šåŸæœ‰çš„ `--verbose` å‚æ•°åªé…ç½®äº†æ ‡å‡† `logging` æ¨¡å—ï¼Œæ²¡æœ‰é…ç½® `loguru`
3. **ç¼ºå°‘æ—¥å¿—é…ç½®**ï¼šæ²¡æœ‰ç»Ÿä¸€çš„æ—¥å¿—é…ç½®å…¥å£

### å½±å“
- å¯åŠ¨ gateway ååªèƒ½çœ‹åˆ°å¯åŠ¨æ¶ˆæ¯
- çœ‹ä¸åˆ° Agent å¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹
- çœ‹ä¸åˆ°å·¥å…·è°ƒç”¨çš„è¯¦ç»†ä¿¡æ¯
- éš¾ä»¥è°ƒè¯•é—®é¢˜

## è§£å†³æ–¹æ¡ˆ

### å·²å®ç°çš„æ”¹è¿›

#### 1. æ–°å¢æ—¥å¿—é…ç½®æ¨¡å—
åˆ›å»ºäº† `nanobot/utils/logging.py`ï¼Œæä¾›ç»Ÿä¸€çš„æ—¥å¿—é…ç½®ï¼š

```python
from nanobot.utils.logging import configure_logging, configure_file_logging

# é…ç½®æ§åˆ¶å°æ—¥å¿—
configure_logging(verbose=True, debug=False)

# é…ç½®æ–‡ä»¶æ—¥å¿—
configure_file_logging("~/.nanobot/logs/gateway.log")
```

#### 2. å¢å¼º gateway å‘½ä»¤
æ–°å¢äº†ä¸‰ä¸ªå‚æ•°ï¼š

| å‚æ•° | çŸ­å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|--------|------|------|
| `--verbose` | `-v` | æ˜¾ç¤º INFO çº§åˆ«æ—¥å¿— | `nanobot gateway -v` |
| `--debug` | `-d` | æ˜¾ç¤º DEBUG çº§åˆ«æ—¥å¿— | `nanobot gateway -d` |
| `--log-file` | `-l` | è¾“å‡ºåˆ°æ–‡ä»¶ | `nanobot gateway -l gateway.log` |

#### 3. æ—¥å¿—æ ¼å¼ä¼˜åŒ–
- **å½©è‰²è¾“å‡º**ï¼šä¸åŒçº§åˆ«ä½¿ç”¨ä¸åŒé¢œè‰²
- **è¯¦ç»†ä¿¡æ¯**ï¼šåŒ…å«æ—¶é—´ã€çº§åˆ«ã€æ¨¡å—ã€å‡½æ•°ã€è¡Œå·
- **æ–‡ä»¶è½®è½¬**ï¼šè‡ªåŠ¨ç®¡ç†æ—¥å¿—æ–‡ä»¶å¤§å°å’Œä¿ç•™æ—¶é—´

## ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹

```bash
# 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼ˆæ¨èï¼‰
nanobot gateway --verbose

# 2. æŸ¥çœ‹è°ƒè¯•æ—¥å¿—
nanobot gateway --debug

# 3. åŒæ—¶è¾“å‡ºåˆ°æ–‡ä»¶
nanobot gateway --verbose --log-file ~/.nanobot/logs/gateway.log
```

### æ—¥å¿—çº§åˆ«å¯¹æ¯”

#### é»˜è®¤æ¨¡å¼ï¼ˆæ— å‚æ•°ï¼‰
```bash
nanobot gateway
```
**è¾“å‡ºï¼š**
```
ğŸˆ Starting nanobot gateway on port 18790...
âœ“ Channels enabled: telegram
```

#### è¯¦ç»†æ¨¡å¼ï¼ˆ--verboseï¼‰
```bash
nanobot gateway --verbose
```
**è¾“å‡ºï¼š**
```
ğŸˆ Starting nanobot gateway on port 18790...
2026-02-07 10:30:15 | INFO     | nanobot.utils.logging:configure_logging:28 - Logging configured at INFO level
2026-02-07 10:30:15 | INFO     | nanobot.channels.manager:_init_channels:44 - Telegram channel enabled
2026-02-07 10:30:15 | INFO     | nanobot.agent.loop:run:112 - Agent loop started
2026-02-07 10:30:15 | INFO     | nanobot.channels.manager:_dispatch_outbound:121 - Outbound dispatcher started
2026-02-07 10:30:16 | INFO     | nanobot.cron.service:start:154 - Cron service started with 0 jobs
âœ“ Channels enabled: telegram
```

#### è°ƒè¯•æ¨¡å¼ï¼ˆ--debugï¼‰
```bash
nanobot gateway --debug
```
**è¾“å‡ºï¼š**
```
ğŸˆ Starting nanobot gateway on port 18790...
2026-02-07 10:30:15 | INFO     | nanobot.utils.logging:configure_logging:28 - Logging configured at DEBUG level
2026-02-07 10:30:15 | INFO     | nanobot.channels.manager:_init_channels:44 - Telegram channel enabled
2026-02-07 10:30:15 | DEBUG    | nanobot.agent.tools.registry:register:25 - Registered tool: read_file
2026-02-07 10:30:15 | DEBUG    | nanobot.agent.tools.registry:register:25 - Registered tool: write_file
2026-02-07 10:30:15 | INFO     | nanobot.agent.loop:run:112 - Agent loop started
...
```

### å®é™…ä½¿ç”¨åœºæ™¯

#### åœºæ™¯ 1ï¼šæ—¥å¸¸ä½¿ç”¨
```bash
nanobot gateway --verbose
```
å¯ä»¥çœ‹åˆ°ï¼š
- é¢‘é“è¿æ¥çŠ¶æ€
- æ¶ˆæ¯æ¥æ”¶å’Œå‘é€
- Agent å¤„ç†è¿›åº¦
- å·¥å…·è°ƒç”¨ç»“æœ

#### åœºæ™¯ 2ï¼šé—®é¢˜è°ƒè¯•
```bash
nanobot gateway --debug --log-file debug.log
```
å¯ä»¥çœ‹åˆ°ï¼š
- æ‰€æœ‰å·¥å…·æ³¨å†Œè¿‡ç¨‹
- è¯¦ç»†çš„å‚æ•°ä¼ é€’
- LLM è°ƒç”¨ç»†èŠ‚
- å®Œæ•´çš„é”™è¯¯å †æ ˆ

#### åœºæ™¯ 3ï¼šç”Ÿäº§ç¯å¢ƒ
```bash
nanobot gateway --log-file ~/.nanobot/logs/gateway.log
```
- ç»ˆç«¯ä¿æŒç®€æ´
- è¯¦ç»†æ—¥å¿—è®°å½•åˆ°æ–‡ä»¶
- è‡ªåŠ¨è½®è½¬å’Œå‹ç¼©

## æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯æ—¥å¿—åŠŸèƒ½ï¼š

```bash
python test_logging.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
ğŸˆ nanobot Logging Test

=== Testing WARNING level (default) ===
2026-02-07 10:30:15 | WARNING  | __main__:test_logging_levels:12 - This is a WARNING message (should appear)
2026-02-07 10:30:15 | ERROR    | __main__:test_logging_levels:13 - This is an ERROR message (should appear)

=== Testing INFO level (--verbose) ===
2026-02-07 10:30:15 | INFO     | __main__:test_logging_levels:18 - This is an INFO message (should appear)
2026-02-07 10:30:15 | WARNING  | __main__:test_logging_levels:19 - This is a WARNING message (should appear)
2026-02-07 10:30:15 | ERROR    | __main__:test_logging_levels:20 - This is an ERROR message (should appear)

=== Testing DEBUG level (--debug) ===
2026-02-07 10:30:15 | DEBUG    | __main__:test_logging_levels:24 - This is a DEBUG message (should appear)
2026-02-07 10:30:15 | INFO     | __main__:test_logging_levels:25 - This is an INFO message (should appear)
2026-02-07 10:30:15 | WARNING  | __main__:test_logging_levels:26 - This is a WARNING message (should appear)
2026-02-07 10:30:15 | ERROR    | __main__:test_logging_levels:27 - This is an ERROR message (should appear)

âœ“ All tests passed!
```

## å¸¸è§é—®é¢˜

### Q1: æ—¥å¿—å¤ªå¤šæ€ä¹ˆåŠï¼Ÿ
**A:** ä½¿ç”¨é»˜è®¤æ¨¡å¼æˆ–åªè®°å½•åˆ°æ–‡ä»¶ï¼š
```bash
# æ–¹å¼ 1ï¼šé»˜è®¤æ¨¡å¼
nanobot gateway

# æ–¹å¼ 2ï¼šåªè®°å½•åˆ°æ–‡ä»¶
nanobot gateway --log-file gateway.log
```

### Q2: å¦‚ä½•è¿‡æ»¤ç‰¹å®šæ—¥å¿—ï¼Ÿ
**A:** ä½¿ç”¨ grepï¼š
```bash
# åªçœ‹é”™è¯¯
nanobot gateway -v 2>&1 | grep ERROR

# åªçœ‹ç‰¹å®šæ¨¡å—
nanobot gateway -v 2>&1 | grep "agent.loop"
```

### Q3: æ—¥å¿—æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ
**A:** ä½¿ç”¨ `--log-file` å‚æ•°æŒ‡å®šï¼Œæ¨èä½ç½®ï¼š
```bash
~/.nanobot/logs/gateway.log
```

### Q4: å¦‚ä½•æŸ¥çœ‹å†å²æ—¥å¿—ï¼Ÿ
**A:** 
```bash
# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œ
tail -n 100 ~/.nanobot/logs/gateway.log

# å®æ—¶æŸ¥çœ‹
tail -f ~/.nanobot/logs/gateway.log

# æœç´¢ç‰¹å®šå†…å®¹
grep "error" ~/.nanobot/logs/gateway.log
```

## ä¸‹ä¸€æ­¥

1. **æµ‹è¯•æ—¥å¿—åŠŸèƒ½**ï¼š
   ```bash
   python test_logging.py
   ```

2. **å¯åŠ¨ gateway éªŒè¯**ï¼š
   ```bash
   nanobot gateway --verbose
   ```

3. **æŸ¥çœ‹å®Œæ•´æ–‡æ¡£**ï¼š
   ```bash
   cat LOGGING.md
   ```

## æ–‡ä»¶æ¸…å•

æœ¬æ¬¡ä¿®æ”¹æ¶‰åŠçš„æ–‡ä»¶ï¼š

1. âœ… `nanobot/utils/logging.py` - æ–°å¢æ—¥å¿—é…ç½®æ¨¡å—
2. âœ… `nanobot/cli/commands.py` - ä¿®æ”¹ gateway å‘½ä»¤
3. âœ… `LOGGING.md` - è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
4. âœ… `test_logging.py` - æµ‹è¯•è„šæœ¬
5. âœ… `æ—¥å¿—é—®é¢˜è§£å†³æ–¹æ¡ˆ.md` - æœ¬æ–‡æ¡£

## æ€»ç»“

é€šè¿‡ä»¥ä¸Šæ”¹è¿›ï¼Œç°åœ¨å¯ä»¥ï¼š
- âœ… ä½¿ç”¨ `--verbose` æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
- âœ… ä½¿ç”¨ `--debug` æŸ¥çœ‹è°ƒè¯•æ—¥å¿—
- âœ… ä½¿ç”¨ `--log-file` è¾“å‡ºåˆ°æ–‡ä»¶
- âœ… å½©è‰²æ ¼å¼åŒ–è¾“å‡º
- âœ… è‡ªåŠ¨æ—¥å¿—è½®è½¬å’Œå‹ç¼©

**ç«‹å³å°è¯•ï¼š**
```bash
nanobot gateway --verbose
```

